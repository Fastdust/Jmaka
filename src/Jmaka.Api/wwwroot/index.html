<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jmaka 0.2.0-rc1</title>
  <link rel="stylesheet" href="app.css?v=0.2.0-rc1" />
</head>
<body>
  <main class="page">
    <section class="uploader" aria-label="Загрузка файла">
      <button class="save-btn" id="saveBtn" type="button" aria-label="Upload image">
        <div class="save-icon" aria-hidden="true">
          <!-- Arrow pointing to the disk -->
          <svg class="save-arrow" viewBox="0 0 64 64" focusable="false">
            <path d="M32 8v22" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" />
            <path d="M20 24l12 12 12-12" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          </svg>

          <!-- Disk icon -->
          <svg class="save-disk" viewBox="0 0 64 64" focusable="false">
            <path d="M10 8h34l10 10v38H10V8zm6 6v12h26V14H16zm0 20v16h32V34H16zm6-16h12v6H22v-6z" />
          </svg>
        </div>
        <div class="save-label">Upload image</div>
      </button>

      <div class="preview-wrap">
        <div class="preview-title">Jmaka 0.2.0-rc1</div>

        <div class="main-controls" aria-label="Панель управления">
          <div class="tool-buttons" aria-label="Инструменты" hidden>
            <button id="splitToolBtn" class="btn tool-btn" type="button">Split</button>
            <button id="split3ToolBtn" class="btn tool-btn" type="button">Split3</button>
            <button id="trashFixToolBtn" class="btn tool-btn" type="button">OknoFix</button>
            <button id="trashToolBtn" class="btn tool-btn" type="button">OknoScale</button>
            <button id="cropToolBtn" class="btn tool-btn" type="button">Crop</button>
          </div>

          <div id="sizeButtons" class="size-buttons" aria-label="Размеры" hidden>
            <button class="size-btn" type="button" data-w="2440" disabled>2440</button>
            <button class="size-btn" type="button" data-w="1920" disabled>1920</button>
            <button class="size-btn" type="button" data-w="1280" disabled>1280</button>
          </div>
        </div>

        <div id="hint" class="hint">Нажмите на дискету, перетащите файлы или вставьте из буфера обмена — и они загрузятся.</div>
        <button id="helpBtn" class="help-btn" type="button" aria-label="Справка">?</button>
      </div>

      <input id="fileInput" class="file-input" type="file" accept="image/*" multiple />
    </section>

    <div class="tables-wrap" aria-label="Таблицы файлов">
      <div class="links-wrap" aria-label="Таблица файлов">
        <div class="links-title">Original / Crop / Sizes</div>
        <div class="table-wrap">
          <table class="files-table" aria-label="Готовые файлы">
            <thead>
              <tr>
                <th class="col-dt">Дата - время</th>
                <th class="col-orig">Оригинал</th>
                <th class="col-crop">Crop</th>
                <th class="col-size">1280</th>
                <th class="col-size">1920</th>
                <th class="col-size">2440</th>
                <th class="col-del"></th>
              </tr>
            </thead>
            <tbody id="filesTbody"></tbody>
          </table>
        </div>
      </div>

      <div class="links-wrap composites-wrap" aria-label="Таблица Split">
      <div class="links-title">Split / Split3 / OknoFix / OknoScale</div>
        <div class="table-wrap">
          <table class="files-table" aria-label="Split / Split3">
            <thead>
              <tr>
                <th class="col-dt">Дата - время</th>
                <th class="col-kind">Тип</th>
                <th class="col-comp">Результат</th>
              </tr>
            </thead>
            <tbody id="compositesTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <pre id="result" class="result" aria-label="Результат" hidden></pre>
  </main>

  <!-- Модалка подтверждения удаления -->
  <div id="deleteModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Удаление">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Удаление</div>
          <div class="modal-sub">
            <span class="modal-subtext">Удалить запись и все связанные файлы безвозвратно?</span>
          </div>
        </div>
        <button id="deleteClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        <label class="checkbox-row">
          <input id="deleteSkipConfirm" type="checkbox" />
          <span>Больше не спрашивать (удалять сразу)</span>
        </label>
      </div>
      <div class="modal-footer">
        <div class="modal-hint">Можно включить обратно, очистив настройку в LocalStorage.</div>
        <div class="modal-actions">
          <button id="deleteCancel" class="btn" type="button">Отмена</button>
          <button id="deleteConfirm" class="btn danger" type="button">Удалить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Просмотр изображения -->
  <div id="viewerModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card viewer-card" role="dialog" aria-modal="true" aria-label="Просмотр изображения">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Просмотр</div>
          <div class="modal-sub">
            <span id="viewerLabel" class="modal-subtext"></span>
            <a id="viewerOpen" class="modal-sublink" href="#" target="_blank" rel="noreferrer" hidden>Открыть в новой вкладке</a>
          </div>
        </div>
        <button id="viewerClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body viewer-body">
        <img id="viewerImg" class="viewer-img" alt="" />
      </div>
    </div>
  </div>

  <!-- Split -->
  <div id="splitModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card split-card" role="dialog" aria-modal="true" aria-label="Split">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Split (2 изображения → 16:9)</div>
          <div class="modal-sub">
            <span class="modal-subtext">Поле 1280×720. Перетаскивайте и масштабируйте изображения, пропорции сохраняются.</span>
          </div>
        </div>
        <button id="splitClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        <div class="split-controls" aria-label="Выбор изображений">
          <div class="split-label">Выберите слот, затем кликните по превью из списка загруженных изображений:</div>
          <div class="split-targets">
            <button id="splitPickTargetA" class="split-target is-active" type="button" aria-label="Выбор для картинки 1">
              <div class="split-target-title">#1</div>
              <img id="splitTargetImgA" class="split-target-img" alt="" />
            </button>
            <button id="splitPickTargetB" class="split-target" type="button" aria-label="Выбор для картинки 2">
              <div class="split-target-title">#2</div>
              <img id="splitTargetImgB" class="split-target-img" alt="" />
            </button>
          </div>
          <div id="splitGallery" class="split-gallery" aria-label="Превью (1280)"></div>
        </div>
        <div id="splitStage" class="split-stage" aria-label="Поле 16:9">
          <div id="splitHalfLeft" class="split-half left" aria-label="Левая половина">
            <div id="splitItemA" class="split-item" data-i="a" hidden>
              <img class="split-img" alt="" />
              <div class="split-handle tl" data-h="tl"></div>
              <div class="split-handle t" data-h="t"></div>
              <div class="split-handle tr" data-h="tr"></div>
              <div class="split-handle r" data-h="r"></div>
              <div class="split-handle br" data-h="br"></div>
              <div class="split-handle b" data-h="b"></div>
              <div class="split-handle bl" data-h="bl"></div>
              <div class="split-handle l" data-h="l"></div>
            </div>
          </div>
          <div id="splitHalfRight" class="split-half right" aria-label="Правая половина">
            <div id="splitItemB" class="split-item" data-i="b" hidden>
              <img class="split-img" alt="" />
              <div class="split-handle tl" data-h="tl"></div>
              <div class="split-handle t" data-h="t"></div>
              <div class="split-handle tr" data-h="tr"></div>
              <div class="split-handle r" data-h="r"></div>
              <div class="split-handle br" data-h="br"></div>
              <div class="split-handle b" data-h="b"></div>
              <div class="split-handle bl" data-h="bl"></div>
              <div class="split-handle l" data-h="l"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div id="splitHint" class="modal-hint">Выберите две картинки из готового размера 1280.</div>
        <div class="modal-actions">
          <button id="splitCancel" class="btn" type="button">Отмена</button>
          <button id="splitApply" class="btn primary" type="button">Склеить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- TrashImg / OknoFix -->
  <div id="trashModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card trash-modal-card" role="dialog" aria-modal="true" aria-label="OknoFix">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">OknoFix (1 изображение → вертикальная карточка)</div>
          <div class="modal-sub">
            <span class="modal-subtext">Окно и рамка фиксированы по шаблону. Двигайте и масштабируйте картинку под окном.</span>
          </div>
        </div>
        <button id="trashClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        <div class="trash-stage-wrap">
          <div id="trashStage" class="trash-stage" aria-label="OknoFix шаблон">
            <div id="trashCard" class="trash-card">
              <div id="trashImgViewport" class="trash-img-viewport">
                <img id="trashImg" class="trash-img" alt="" />
              </div>
              <!-- PNG-шаблон всегда поверх картинки, чтобы превью совпадало с итоговым видом -->
              <div class="trash-overlay" aria-hidden="true"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div id="trashHint" class="modal-hint">Выберите строку в таблице файлов, затем откройте OknoFix.</div>
        <div class="modal-actions">
          <div class="trash-zoom-controls" aria-label="Масштаб картинки подложки">
            <button id="trashZoomOut" class="btn trash-zoom-btn" type="button">−</button>
            <button id="trashZoomIn" class="btn trash-zoom-btn" type="button">+</button>
          </div>
          <button id="trashCancel" class="btn" type="button">Закрыть</button>
          <button id="trashApply" class="btn primary" type="button" disabled>Сделать</button>
        </div>
      </div>
    </div>
  </div>

  <!-- OknoScale -->
  <div id="oknoScaleModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card trash-modal-card" role="dialog" aria-modal="true" aria-label="OknoScale">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">OknoScale (1 изображение → вертикальная карточка)</div>
          <div class="modal-sub">
            <span class="modal-subtext">Окно фиксировано по высоте и центрировано, ширину можно менять симметрично от центра.</span>
          </div>
        </div>
        <button id="oknoScaleClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        <div class="trash-stage-wrap">
          <div id="oknoScaleStage" class="trash-stage" aria-label="OknoScale шаблон">
            <div id="oknoScaleCard" class="trash-card">
              <div id="oknoScaleImgViewport" class="trash-img-viewport">
                <img id="oknoScaleImg" class="trash-img" alt="" />
              </div>
              <div id="oknoScaleHandleLeft" class="oknoscale-handle left" data-side="left"></div>
              <div id="oknoScaleHandleRight" class="oknoscale-handle right" data-side="right"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div id="oknoScaleHint" class="modal-hint">Выберите строку в таблице файлов, затем откройте OknoScale.</div>
        <div class="modal-actions">
          <div class="trash-zoom-controls" aria-label="Масштаб картинки подложки">
            <button id="oknoScaleZoomOut" class="btn trash-zoom-btn" type="button">−</button>
            <button id="oknoScaleZoomIn" class="btn trash-zoom-btn" type="button">+</button>
          </div>
          <button id="oknoScaleCancel" class="btn" type="button">Закрыть</button>
          <button id="oknoScaleApply" class="btn primary" type="button" disabled>Сделать</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Split3 -->
  <div id="split3Modal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card split-card split3-card" role="dialog" aria-modal="true" aria-label="Split3">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Split3 (3 изображения → 16:9)</div>
          <div class="modal-sub">
            <span class="modal-subtext">Поле 1280×720. Перетаскивайте и масштабируйте изображения, пропорции сохраняются.</span>
          </div>
        </div>
        <button id="split3Close" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        <div class="split-controls" aria-label="Выбор изображений">
          <div class="split-label">Выберите слот, затем кликните по превью из списка загруженных изображений:</div>
          <div class="split-targets">
            <button id="split3PickTargetA" class="split-target is-active" type="button" aria-label="Выбор для картинки 1">
              <div class="split-target-title">#1</div>
              <img id="split3TargetImgA" class="split-target-img" alt="" />
            </button>
            <button id="split3PickTargetB" class="split-target" type="button" aria-label="Выбор для картинки 2">
              <div class="split-target-title">#2</div>
              <img id="split3TargetImgB" class="split-target-img" alt="" />
            </button>
            <button id="split3PickTargetC" class="split-target" type="button" aria-label="Выбор для картинки 3">
              <div class="split-target-title">#3</div>
              <img id="split3TargetImgC" class="split-target-img" alt="" />
            </button>
          </div>
          <div id="split3Gallery" class="split-gallery" aria-label="Превью"></div>
        </div>
        <div id="split3Stage" class="split-stage split3-stage" aria-label="Поле 16:9">
          <div id="split3ThirdA" class="split-half split3-third one" aria-label="Треть 1">
            <div id="split3ItemA" class="split-item" data-i="a" hidden>
              <img class="split-img" alt="" />
              <div class="split-handle tl" data-h="tl"></div>
              <div class="split-handle t" data-h="t"></div>
              <div class="split-handle tr" data-h="tr"></div>
              <div class="split-handle r" data-h="r"></div>
              <div class="split-handle br" data-h="br"></div>
              <div class="split-handle b" data-h="b"></div>
              <div class="split-handle bl" data-h="bl"></div>
              <div class="split-handle l" data-h="l"></div>
            </div>
          </div>
          <div id="split3ThirdB" class="split-half split3-third two" aria-label="Треть 2">
            <div id="split3ItemB" class="split-item" data-i="b" hidden>
              <img class="split-img" alt="" />
              <div class="split-handle tl" data-h="tl"></div>
              <div class="split-handle t" data-h="t"></div>
              <div class="split-handle tr" data-h="tr"></div>
              <div class="split-handle r" data-h="r"></div>
              <div class="split-handle br" data-h="br"></div>
              <div class="split-handle b" data-h="b"></div>
              <div class="split-handle bl" data-h="bl"></div>
              <div class="split-handle l" data-h="l"></div>
            </div>
          </div>
          <div id="split3ThirdC" class="split-half split3-third three" aria-label="Треть 3">
            <div id="split3ItemC" class="split-item" data-i="c" hidden>
              <img class="split-img" alt="" />
              <div class="split-handle tl" data-h="tl"></div>
              <div class="split-handle t" data-h="t"></div>
              <div class="split-handle tr" data-h="tr"></div>
              <div class="split-handle r" data-h="r"></div>
              <div class="split-handle br" data-h="br"></div>
              <div class="split-handle b" data-h="b"></div>
              <div class="split-handle bl" data-h="bl"></div>
              <div class="split-handle l" data-h="l"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div id="split3Hint" class="modal-hint">Выберите три картинки.</div>
        <div class="modal-actions">
          <button id="split3Cancel" class="btn" type="button">Отмена</button>
          <button id="split3Apply" class="btn primary" type="button">Склеить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Модалка кадрирования -->
  <div id="cropModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card crop-card" role="dialog" aria-modal="true" aria-label="Кадрирование">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Кадрирование</div>
          <div class="modal-sub">
            <span id="cropSourceLabel" class="modal-subtext"></span>
            <a id="cropOpenOriginal" class="modal-sublink" href="#" target="_blank" rel="noreferrer" hidden>Открыть оригинал</a>
          </div>
        </div>
        <button id="cropClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        <div id="cropStage" class="crop-stage">
          <img id="cropImg" class="crop-img" alt="" />
          <div id="cropRect" class="crop-rect">
            <div class="crop-handle tl" data-h="tl"></div>
            <div class="crop-handle tr" data-h="tr"></div>
            <div class="crop-handle bl" data-h="bl"></div>
            <div class="crop-handle br" data-h="br"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="modal-hint">
          Перетаскивайте рамку и её углы. Выберите пропорции:
          <div class="aspect-buttons" aria-label="Пропорции кадрирования">
            <button class="btn aspect-btn" type="button" data-aw="1" data-ah="1">1:1</button>
            <button class="btn aspect-btn" type="button" data-aw="2" data-ah="3">2:3</button>
            <button class="btn aspect-btn is-active" type="button" data-aw="16" data-ah="9">16:9</button>
          </div>
        </div>
        <div class="modal-actions">
          <button id="cropCancel" class="btn" type="button">Отмена</button>
          <button id="cropApply" class="btn primary" type="button">Обрезать</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Справка -->
  <div id="helpModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card help-card" role="dialog" aria-modal="true" aria-label="Справка по Jmaka">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Справка по Jmaka</div>
          <div class="modal-sub">
            <span class="modal-subtext">Краткое описание всех функций и горячих действий.</span>
          </div>
        </div>
        <button id="helpClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body help-body">
        <p><strong>Jmaka</strong> — небольшое веб-приложение для загрузки и обработки изображений.</p>
        <h3>Загрузка файлов</h3>
        <ul>
          <li>Кнопка-дискета — выбор до 15 файлов за раз.</li>
          <li>Поддержка drag &amp; drop: просто перетащите файлы на окно.</li>
          <li>Вставка из буфера обмена (Ctrl+V) для картинок.</li>
        </ul>
        <h3>Таблица файлов</h3>
        <ul>
          <li>Каждая строка — загруженное изображение (новые сверху).</li>
          <li>В ячейке «Оригинал» — миниатюра + маленькая кнопка-дискета для скачивания.</li>
          <li>Размеры 1280 / 1920 / 2440 создаются по клику по кнопкам сверху.</li>
          <li>Крестик справа удаляет запись и все связанные файлы.</li>
        </ul>
        <h3>Инструменты</h3>
        <ul>
          <li><strong>Crop</strong> — кадрирование исходника с выбором пропорций (1:1, 2:3, 16:9).</li>
          <li><strong>Split</strong> — две картинки → одна 1280×720, белая полоса 7px по центру.</li>
          <li><strong>Split3</strong> — три картинки → одна 1280×720, две белые полосы 7px.</li>
          <li><strong>OknoFix</strong> — вертикальная карточка по строгому PNG-шаблону:
            <ul>
              <li>режим фиксированного окна (как на исходном PNG);</li>
              <li>картинка подложки двигается мышью и масштабируется пропорционально;</li>
              <li>масштаб — через колесо мыши или кнопки «−»/«+» внизу справа.</li>
            </ul>
          </li>
          <li><strong>OknoScale</strong> — экспериментальный режим той же карточки с изменяемой шириной окна.</li>
        </ul>
        <h3>Прочее</h3>
        <ul>
          <li>История Split / Split3 / TrashImg — в правой таблице.</li>
          <li>Каждый результат можно открыть, скачать или удалить.</li>
          <li>Старые записи и файлы автоматически очищаются по времени хранения.</li>
        </ul>
      </div>
    </div>
  </div>

  <script src="app.js?v=0.2.0-rc1"></script>
</body>
</html>
